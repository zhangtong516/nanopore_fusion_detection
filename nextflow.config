params {
  jaffa_ref_dir = "/home/users/astar/acrc/aicloudtestuser3/scratch/reference/GRCh38/jaffa_hg38/"

}

params {
  samplesheet = ''
  outdir = 'results'
  dorado_model = ''
  dorado_device = 'gpu'
  jaffa_ref_dir = ''
  jaffa_sif = ''
}

profiles {
  standard {
    process.executor = 'local'
  }
  docker {
    docker.enabled = true
    docker.runOptions = params.jaffa_ref_dir ? "-v ${params.jaffa_ref_dir}:/ref" : ''
  }
  singularity {
    singularity.enabled = true
    singularity.autoMounts = true
  }
  apptainer {
    singularity.enabled = true
    singularity.autoMounts = true
  }
}

process {
  // Default process configuration
  executor = 'slurm'
  clusterOptions = { ' -V --partition=testqueue --gres=gpu:1  -A aicloud-testgroup ' }  // Remove account specification or update with your actual account
  penv = 'OpenMP'
  // errorStrategy = { task.attempt < 2 ? 'retry' : 'finish' }
  pollInterval = '30 sec'
  exitReadTimeout = "120 sec"
  withName: DORADO_BASECALL {
    cpus = 8
    memory = '32 GB'
    time = '3h'
    accelerator = 1
    container = 'ontresearch/dorado:latest'
    containerOptions = '--gpus all --shm-size=8g'
    clusterOptions = '-V --partition=testqueue -A aicloud-testgroup --gres=gpu:1'  // Request 1 GPU explicitly
  }

  withName: RUN_JAFFAL {
    cpus = 8
    memory = '16 GB'
    container = ""
  }
  withName: MAKE_REPORT {
    cpus = 1
  }
}

